================================================================================
  SLA BREACH ALERT
  Host       : {{ inventory_hostname }}
  Timestamp  : {{ ansible_date_time.iso8601 }}
================================================================================

{% if sla_uptime_result is defined and sla_uptime_result.breached | default(false) %}
---- UPTIME SLA ----------------------------------------------------------------
  Target          : {{ sla_uptime_target_percent }} %
  Current         : {{ sla_uptime_result.current_value }}
  Budget used     : {{ (sla_uptime_result.pct_used * 100) | round(2) }} %
  Severity        : {{ sla_uptime_result.severity | upper }}
  Window          : {{ sla_uptime_window_hours }} hours
{% else %}
---- UPTIME SLA — within target
{% endif %}

{% if sla_response_result is defined and sla_response_result.breached | default(false) %}
---- RESPONSE-TIME SLA ---------------------------------------------------------
  Target (max ms) : {{ sla_response_time_max_ms }}
  Worst measured  : {{ sla_response_result.current_value }} ms
  Budget used     : {{ (sla_response_result.pct_used * 100) | round(2) }} %
  Severity        : {{ sla_response_result.severity | upper }}
  Endpoints:
{% for ep in sla_response_endpoints %}
    - {{ ep }}
{% endfor %}
{% else %}
---- RESPONSE-TIME SLA — within target
{% endif %}

{% if sla_error_result is defined and sla_error_result.breached | default(false) %}
---- ERROR-RATE SLA ------------------------------------------------------------
  Target (err/min): {{ sla_error_rate_max_per_minute }}
  Measured        : {{ sla_error_result.current_value | int }}
  Budget used     : {{ (sla_error_result.pct_used * 100) | round(2) }} %
  Severity        : {{ sla_error_result.severity | upper }}
{% else %}
---- ERROR-RATE SLA — within target
{% endif %}

================================================================================
  State persisted to: {{ sla_state_dir }}
================================================================================
