---
# ---------------------------------------------------------------------------
# configuration / tasks / main.yml
# ---------------------------------------------------------------------------

- name: "[configuration] Abort early if master switch is off"
  ansible.builtin.debug:
    msg: "Configuration role is DISABLED (configuration_enabled=false). Skipping."
  when: not configuration_enabled

- name: "[configuration] Ensure backup directory exists"
  ansible.builtin.file:
    path: "{{ configuration_backup_dir }}"
    state: directory
    mode: "0700"
    owner: root
  when: configuration_enabled and configuration_backup_enabled

# ======================================================================
# NTP / Chrony
# ======================================================================
- name: "[configuration] Include NTP tasks"
  ansible.builtin.include_tasks: ntp.yml
  when: configuration_enabled and configuration_ntp_enabled

# ======================================================================
# Sysctl Tuning
# ======================================================================
- name: "[configuration] Include sysctl tasks"
  ansible.builtin.include_tasks: sysctl.yml
  when: configuration_enabled and configuration_sysctl_enabled

# ======================================================================
# Rsyslog
# ======================================================================
- name: "[configuration] Include rsyslog tasks"
  ansible.builtin.include_tasks: rsyslog.yml
  when: configuration_enabled and configuration_rsyslog_enabled

# ======================================================================
# MOTD
# ======================================================================
- name: "[configuration] Include MOTD tasks"
  ansible.builtin.include_tasks: motd.yml
  when: configuration_enabled and configuration_motd_enabled
