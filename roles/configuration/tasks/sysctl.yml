---
# ---------------------------------------------------------------------------
# configuration / tasks / sysctl.yml
# ---------------------------------------------------------------------------

- name: "[configuration|sysctl] Backup existing sysctl drop-in"
  ansible.builtin.copy:
    src: "{{ configuration_sysctl_conf_path }}"
    dest: "{{ configuration_backup_dir }}/99-ansible.conf.{{ ansible_date_time.epoch }}"
    remote_src: true
    mode: "0600"
  when: configuration_backup_enabled
  failed_when: false

- name: "[configuration|sysctl] Write sysctl drop-in"
  ansible.builtin.copy:
    content: |
      # Managed by Ansible â€” do not hand-edit.
      {% for key, value in configuration_sysctl_params.items() %}
      {{ key }} = {{ value }}
      {% endfor %}
    dest: "{{ configuration_sysctl_conf_path }}"
    owner: root
    mode: "0644"
  notify: configuration_apply_sysctl
