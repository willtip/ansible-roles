---
# ---------------------------------------------------------------------------
# onetime / handlers / main.yml
# ---------------------------------------------------------------------------

- name: onetime_notify_slack
  listen: onetime_notify_slack
  ansible.builtin.uri:
    url: "{{ onetime_slack_webhook_url }}"
    method: POST
    body_format: json
    body:
      text: >
        :white_check_mark: *One-time operation complete* —
        `{{ onetime_operation_id }}` on `{{ inventory_hostname }}`
        finished at `{{ ansible_date_time.iso8601 }}`.
    status_code: [200]
  when: onetime_slack_webhook_url | length > 0

- name: onetime_notify_rollback
  listen: onetime_notify_rollback
  ansible.builtin.uri:
    url: "{{ onetime_slack_webhook_url }}"
    method: POST
    body_format: json
    body:
      text: >
        :bangbang: *ROLLBACK executed* —
        `{{ onetime_operation_id }}` on `{{ inventory_hostname }}`
        was rolled back at `{{ ansible_date_time.iso8601 }}`.
    status_code: [200]
  when: onetime_slack_webhook_url | length > 0
