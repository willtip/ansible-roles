---
# ---------------------------------------------------------------------------
# operational / handlers / main.yml
# ---------------------------------------------------------------------------

- name: operational_notify_restart
  listen: operational_notify_restart
  ansible.builtin.uri:
    url: "{{ operational_slack_webhook_url }}"
    method: POST
    body_format: json
    body:
      text: >
        :arrows_counterclockwise: *Services Restarted* on `{{ inventory_hostname }}`
        at `{{ ansible_date_time.iso8601 }}`.
        Restarted: {{ operational_unhealthy_services | join(', ') }}.
    status_code: [200]
  when: operational_slack_webhook_url | length > 0
