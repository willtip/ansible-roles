================================================================================
  OPERATIONAL RUN REPORT
  Host       : {{ inventory_hostname }}
  Timestamp  : {{ ansible_date_time.iso8601 }}
================================================================================

---- HEALTH CHECK RESULTS ------------------------------------------------------
{% if operational_health_results is defined %}
{% for r in operational_health_results.results %}
  [{{ 'OK' if r.healthy else 'UNHEALTHY' }}]  {{ r.name }}
        State   : {{ r.state }}
        PID     : {{ r.pid }}
        Uptime  : {{ r.uptime_s }}s
{% endfor %}
{% else %}
  No services monitored.
{% endif %}

---- RESTARTS ------------------------------------------------------------------
{% if operational_unhealthy_services is defined and operational_unhealthy_services | length > 0 %}
  Restarted services:
{% for svc in operational_unhealthy_services %}
    - {{ svc }}
{% endfor %}
{% else %}
  All services healthy â€” no restarts required.
{% endif %}

---- HOUSEKEEPING --------------------------------------------------------------
{% if operational_stale_files is defined %}
  Stale files purged: {{ operational_stale_files.files | length }}
  Directories scanned: {{ operational_purge_directories | join(', ') }}
  Max age: {{ operational_purge_max_age_days }} day(s)
{% endif %}

---- BACKUPS -------------------------------------------------------------------
{% if operational_backup_enabled %}
  Backup location : {{ operational_backup_dir }}/{{ operational_backup_timestamp }}
  Targets         : {{ operational_backup_targets | join(', ') | default('none') }}
  Retention (gens): {{ operational_backup_retention_count }}
{% else %}
  Backups disabled.
{% endif %}

================================================================================
  END OF REPORT
================================================================================
